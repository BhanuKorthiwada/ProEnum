parameters:
  buildConfig: $(BuildConfig)
  nugetSource: $(NuGetPrivateSource)
  nugetApiKey: $(NuGetPrivateApiKey)
  solution: $(DotNetSolution)

jobs:
  - job: BuildPackPush
    continueOnError: true
    pool:
      vmImage: $(BuildImage)
    steps:
      - task: UseDotNet@2
        displayName: "Setup : .NET Core SDK"
        inputs:
          packageType: sdk
          version: 5.0.x
          includePreviewVersions: true
          installationPath: $(Agent.ToolsDirectory)/dotnet

      - script: dotnet build ${{ parameters.solution }} -c ${{ parameters.buildConfig }}
        displayName: "Build"

      - script: dotnet pack ${{ parameters.solution }} -c ${{ parameters.buildConfig }} -o $(Build.ArtifactStagingDirectory) --include-symbols --include-source
        displayName: "Pack"

      - script: dotnet nuget push "$(Build.ArtifactStagingDirectory)/*.nupkg" -s ${{ parameters.nugetSource }} --api-key ${{ parameters.nugetApiKey }} --skip-duplicate
        displayName: "Push"
